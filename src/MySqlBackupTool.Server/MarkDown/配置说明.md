# MySQL备份工具服务器配置说明

本文档详细说明了MySQL备份工具服务器端的配置文件结构和各项参数的含义。

## 配置文件结构

### MySqlBackupTool 核心配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `ConnectionString` | string | 数据库连接字符串，指定SQLite数据库文件位置 | "Data Source=server_backup_tool.db" |
| `EnableEncryption` | boolean | 是否启用备份文件加密功能 | true |
| `EnableNotifications` | boolean | 是否启用通知功能 | true |
| `DefaultCompressionLevel` | string | 默认压缩级别：Fastest/Optimal/Maximum | "Optimal" |
| `MaxConcurrentBackups` | integer | 最大并发备份任务数量 | 5 |
| `DefaultRetentionDays` | integer | 默认备份保留天数 | 30 |
| `EnableAuditing` | boolean | 是否启用审计日志 | true |
| `AuditLogPath` | string | 审计日志文件路径模板 | "logs/audit/backup-audit-{Date}.log" |

### ServerConfig 服务器配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `ListenPort` | integer | 服务器监听端口号 | 8080 |
| `MaxConcurrentConnections` | integer | 最大并发连接数 | 20 |
| `EnableSsl` | boolean | 是否启用SSL/TLS加密传输 | true |
| `SslCertificatePath` | string | SSL证书文件路径 | "certificates/server.pfx" |
| `SslCertificatePassword` | string | SSL证书密码 | - |
| `AuthenticationRequired` | boolean | 是否需要客户端认证 | true |
| `AllowedClients` | array | 允许连接的客户端IP地址或网段 | ["127.0.0.1", "192.168.1.0/24"] |

### StorageConfig 存储配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `PrimaryStoragePath` | string | 主要存储路径 | "backups" |
| `EnableCompression` | boolean | 是否启用存储压缩 | true |
| `EnableEncryption` | boolean | 是否启用存储加密 | true |
| `MaxStorageSize` | string | 最大存储空间限制 | "100GB" |
| `CleanupInterval` | string | 清理任务执行间隔（HH:mm:ss格式） | "24:00:00" |

### Alerting 告警配置

#### 基础告警设置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `EnableAlerting` | boolean | 是否启用告警功能 | true |
| `BaseUrl` | string | 告警服务基础URL | - |
| `TimeoutSeconds` | integer | 告警请求超时时间（秒） | 30 |
| `MaxRetryAttempts` | integer | 最大重试次数 | 3 |
| `EnableCircuitBreaker` | boolean | 是否启用熔断器模式 | true |
| `MinimumSeverity` | string | 最小告警级别：Information/Warning/Error/Critical | "Warning" |
| `MaxAlertsPerHour` | integer | 每小时最大告警数量 | 50 |
| `NotificationTimeout` | string | 通知超时时间 | "00:01:00" |

#### Email 邮件告警配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Enabled` | boolean | 是否启用邮件告警 | true |
| `SmtpServer` | string | SMTP服务器地址 | "smtp.gmail.com" |
| `SmtpPort` | integer | SMTP服务器端口 | 587 |
| `UseSsl` | boolean | 是否使用SSL连接 | true |
| `Username` | string | SMTP用户名 | - |
| `Password` | string | SMTP密码或应用专用密码 | - |
| `FromAddress` | string | 发件人邮箱地址 | - |
| `Recipients` | array | 收件人邮箱地址列表 | [] |

#### Webhook 网络钩子告警配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Enabled` | boolean | 是否启用Webhook告警 | false |
| `Url` | string | Webhook URL地址 | - |
| `HttpMethod` | string | HTTP请求方法 | "POST" |
| `ContentType` | string | 内容类型 | "application/json" |
| `AuthToken` | string | 认证令牌 | - |

#### FileLog 文件日志告警配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Enabled` | boolean | 是否启用文件日志告警 | true |
| `LogDirectory` | string | 日志文件目录 | "logs/alerts" |
| `FileNamePattern` | string | 日志文件名模式 | "alerts_{yyyy-MM-dd}.log" |
| `MaxFileSizeMB` | integer | 单个日志文件最大大小（MB） | 10 |
| `MaxFileCount` | integer | 最大保留日志文件数量 | 30 |

### SmtpConfig SMTP配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Host` | string | SMTP服务器主机地址 | "smtp.gmail.com" |
| `Port` | integer | SMTP服务器端口 | 587 |
| `EnableSsl` | boolean | 是否启用SSL/TLS | true |
| `Username` | string | SMTP用户名 | - |
| `Password` | string | SMTP密码 | - |
| `FromAddress` | string | 发件人地址 | - |
| `FromName` | string | 发件人显示名称 | "MySQL 备份服务" |
| `TimeoutSeconds` | integer | 连接超时时间（秒） | 30 |

### Logging 日志配置

#### 日志级别配置

| 配置项 | 类型 | 说明 | 可选值 |
|--------|------|------|--------|
| `Default` | string | 默认日志级别 | Trace/Debug/Information/Warning/Error/Critical |
| `MySqlBackupTool` | string | 应用程序日志级别 | 同上 |
| `Microsoft` | string | Microsoft组件日志级别 | 同上 |
| `System` | string | 系统组件日志级别 | 同上 |

#### 文件日志配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Path` | string | 日志文件路径模板 | "logs/server-{Date}.log" |
| `RollingInterval` | string | 日志滚动间隔 | "Day" |
| `RetainedFileCountLimit` | integer | 保留的日志文件数量限制 | 30 |
| `FileSizeLimitBytes` | integer | 单个日志文件大小限制（字节） | 10485760 |

#### 控制台日志配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `Enabled` | boolean | 是否启用控制台日志输出 | true |
| `IncludeScopes` | boolean | 是否包含日志作用域信息 | false |

### MemoryProfiling 内存分析配置

| 配置项 | 类型 | 说明 | 默认值 |
|--------|------|------|--------|
| `EnableProfiling` | boolean | 是否启用内存分析 | false |
| `ProfilingInterval` | string | 内存分析间隔时间 | "00:05:00" |
| `MaxMemoryThresholdMB` | integer | 内存使用阈值（MB） | 1024 |
| `EnableGCCollection` | boolean | 是否启用垃圾回收 | true |
| `LogMemoryUsage` | boolean | 是否记录内存使用情况 | true |

## 环境特定配置

### 开发环境 (appsettings.Development.json)

开发环境配置通常具有以下特点：
- 较低的安全要求（禁用SSL、认证等）
- 更详细的日志记录
- 较小的资源限制
- 更频繁的内存分析

### 生产环境 (appsettings.json)

生产环境配置应该：
- 启用所有安全功能（SSL、认证、加密）
- 适当的日志级别（避免过多的调试信息）
- 合理的资源限制
- 完整的告警配置

## 配置最佳实践

1. **安全性**：
   - 生产环境必须启用SSL和认证
   - 使用强密码和证书
   - 限制允许的客户端IP范围

2. **性能**：
   - 根据服务器性能调整并发连接数和备份任务数
   - 选择合适的压缩级别平衡性能和存储空间

3. **监控**：
   - 启用完整的日志记录和告警
   - 配置多种告警方式确保及时通知

4. **维护**：
   - 设置合理的日志保留策略
   - 配置自动清理任务避免磁盘空间不足

5. **敏感信息**：
   - 使用环境变量或密钥管理服务存储敏感配置
   - 不要在配置文件中硬编码密码和密钥