# MySQL备份工具服务器端快速启动指南

## 概述

本指南将帮助您快速启动和配置MySQL备份工具服务器端应用程序。

## 系统要求

### 最低要求
- **操作系统**：Windows 10/11, Windows Server 2019/2022, Linux (Ubuntu 20.04+), macOS 10.15+
- **.NET运行时**：.NET 8.0 Runtime或更高版本
- **内存**：最少512MB可用内存
- **磁盘空间**：至少1GB可用空间（不包括备份存储空间）
- **网络**：可访问的网络端口（默认8080）

### 推荐配置
- **内存**：2GB或更多
- **磁盘空间**：根据备份需求预留足够空间
- **网络**：千兆网络连接以获得最佳传输性能

## 快速启动步骤

### 1. 环境准备

#### 安装.NET 8.0运行时
```bash
# Windows (使用winget)
winget install Microsoft.DotNet.Runtime.8

# Ubuntu/Debian
wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
sudo apt-get update
sudo apt-get install -y dotnet-runtime-8.0

# macOS (使用Homebrew)
brew install --cask dotnet
```

#### 创建工作目录
```bash
# 创建应用程序目录
mkdir -p /opt/mysql-backup-server
cd /opt/mysql-backup-server

# 创建必要的子目录
mkdir -p backups logs certificates
```

### 2. 应用程序部署

#### 方式一：从源码构建
```bash
# 克隆项目（如果从源码部署）
git clone <repository-url>
cd MySqlBackupTool/src/MySqlBackupTool.Server

# 构建项目
dotnet build -c Release

# 发布应用
dotnet publish -c Release -o /opt/mysql-backup-server
```

#### 方式二：使用预构建版本
```bash
# 下载预构建版本
wget <release-url>/mysql-backup-server-v1.0.0.zip
unzip mysql-backup-server-v1.0.0.zip -d /opt/mysql-backup-server
```

### 3. 基础配置

#### 复制配置文件
```bash
cd /opt/mysql-backup-server

# 复制默认配置文件
cp appsettings.json appsettings.Production.json
```

#### 编辑配置文件
```bash
# 使用您喜欢的编辑器编辑配置
nano appsettings.Production.json
```

**最小配置示例**：
```json
{
  "MySqlBackupTool": {
    "ConnectionString": "Data Source=/opt/mysql-backup-server/server_backup_tool.db"
  },
  "ServerConfig": {
    "ListenPort": 8080,
    "EnableSsl": false,
    "AuthenticationRequired": false
  },
  "StorageConfig": {
    "PrimaryStoragePath": "/opt/mysql-backup-server/backups"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  }
}
```

### 4. 启动服务

#### 开发/测试环境
```bash
# 直接运行
cd /opt/mysql-backup-server
dotnet MySqlBackupTool.Server.dll

# 或指定环境
ASPNETCORE_ENVIRONMENT=Development dotnet MySqlBackupTool.Server.dll
```

#### 生产环境（前台运行）
```bash
cd /opt/mysql-backup-server
ASPNETCORE_ENVIRONMENT=Production dotnet MySqlBackupTool.Server.dll
```

#### 生产环境（后台服务）

**Linux (systemd)**：
```bash
# 创建服务文件
sudo nano /etc/systemd/system/mysql-backup-server.service
```

服务文件内容：
```ini
[Unit]
Description=MySQL Backup Tool Server
After=network.target

[Service]
Type=notify
ExecStart=/usr/bin/dotnet /opt/mysql-backup-server/MySqlBackupTool.Server.dll
Restart=always
RestartSec=5
KillSignal=SIGINT
SyslogIdentifier=mysql-backup-server
User=mysql-backup
Environment=ASPNETCORE_ENVIRONMENT=Production
Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false
WorkingDirectory=/opt/mysql-backup-server

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
# 重新加载systemd配置
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start mysql-backup-server

# 设置开机自启
sudo systemctl enable mysql-backup-server

# 查看服务状态
sudo systemctl status mysql-backup-server
```

**Windows服务**：
```cmd
# 使用sc命令创建Windows服务
sc create MySqlBackupServer binPath="C:\mysql-backup-server\MySqlBackupTool.Server.exe" start=auto

# 启动服务
sc start MySqlBackupServer

# 查看服务状态
sc query MySqlBackupServer
```

### 5. 验证安装

#### 检查服务状态
```bash
# 检查进程是否运行
ps aux | grep MySqlBackupTool.Server

# 检查端口是否监听
netstat -tlnp | grep :8080
# 或使用ss命令
ss -tlnp | grep :8080
```

#### 测试连接
```bash
# 使用telnet测试端口连通性
telnet localhost 8080

# 或使用nc命令
nc -zv localhost 8080
```

#### 查看日志
```bash
# 查看应用程序日志
tail -f /opt/mysql-backup-server/logs/server-$(date +%Y%m%d).log

# 查看系统服务日志（Linux）
sudo journalctl -u mysql-backup-server -f

# 查看Windows事件日志
eventvwr.msc
```

## 常见配置场景

### 场景1：开发环境（最简配置）
```json
{
  "ServerConfig": {
    "ListenPort": 8080,
    "EnableSsl": false,
    "AuthenticationRequired": false
  },
  "Logging": {
    "LogLevel": {
      "Default": "Debug"
    }
  }
}
```

### 场景2：生产环境（安全配置）
```json
{
  "ServerConfig": {
    "ListenPort": 8443,
    "EnableSsl": true,
    "SslCertificatePath": "/opt/mysql-backup-server/certificates/server.pfx",
    "SslCertificatePassword": "your_certificate_password",
    "AuthenticationRequired": true,
    "AllowedClients": ["192.168.1.0/24"]
  },
  "Alerting": {
    "EnableAlerting": true,
    "Email": {
      "Enabled": true,
      "SmtpServer": "smtp.company.com",
      "SmtpPort": 587,
      "Username": "backup@company.com",
      "Recipients": ["admin@company.com"]
    }
  }
}
```

### 场景3：高可用环境
```json
{
  "ServerConfig": {
    "MaxConcurrentConnections": 50
  },
  "MySqlBackupTool": {
    "MaxConcurrentBackups": 10
  },
  "StorageConfig": {
    "MaxStorageSize": "1TB"
  },
  "MemoryProfiling": {
    "EnableProfiling": true,
    "MaxMemoryThresholdMB": 2048
  }
}
```

## 故障排除

### 启动失败
1. **检查.NET运行时**：
   ```bash
   dotnet --version
   ```

2. **检查配置文件语法**：
   ```bash
   # 使用JSON验证工具
   python -m json.tool appsettings.json
   ```

3. **检查文件权限**：
   ```bash
   ls -la /opt/mysql-backup-server/
   ```

### 连接问题
1. **检查防火墙**：
   ```bash
   # Linux (ufw)
   sudo ufw allow 8080
   
   # Linux (iptables)
   sudo iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
   
   # Windows
   netsh advfirewall firewall add rule name="MySQL Backup Server" dir=in action=allow protocol=TCP localport=8080
   ```

2. **检查端口占用**：
   ```bash
   # Linux
   sudo lsof -i :8080
   
   # Windows
   netstat -ano | findstr :8080
   ```

### 性能问题
1. **监控资源使用**：
   ```bash
   # CPU和内存使用情况
   top -p $(pgrep -f MySqlBackupTool.Server)
   
   # 磁盘使用情况
   df -h /opt/mysql-backup-server/backups
   ```

2. **调整配置参数**：
   - 减少`MaxConcurrentConnections`
   - 调整`DefaultCompressionLevel`
   - 启用`MemoryProfiling`

## 下一步

1. **配置客户端**：参考客户端配置文档连接到服务器
2. **设置监控**：配置告警和监控系统
3. **备份策略**：制定备份保留和清理策略
4. **安全加固**：启用SSL、认证和访问控制
5. **性能优化**：根据实际负载调整配置参数

## 获取帮助

- **查看详细文档**：[README.md](./README.md)
- **配置参考**：[配置说明.md](./配置说明.md)
- **日志分析**：检查应用程序和系统日志
- **社区支持**：提交Issue或参与讨论